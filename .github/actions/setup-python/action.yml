name: 'Setup Python Environment'
description: 'Set up Python environment with pip caching and AI/ML dependencies'
inputs:
  python-version:
    description: 'Python version to set up'
    required: false
    default: '3.11'
  install-ai-deps:
    description: 'Install AI/ML dependencies'
    required: false
    default: 'true'
outputs:
  python-version:
    description: 'The Python version that was set up'
    value: ${{ steps.setup.outputs.python-version }}

runs:
  using: 'composite'
  steps:
    - name: Set up Python ${{ inputs.python-version }}
      id: setup
      uses: actions/setup-python@v4
      with:
        python-version: ${{ inputs.python-version }}

    - name: Cache pip dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('ai-services/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Upgrade pip
      shell: bash
      run: python -m pip install --upgrade pip

    - name: Install AI dependencies
      if: inputs.install-ai-deps == 'true'
      shell: bash
      run: |
        cd ai-services
        pip install -r requirements.txt

    - name: Set Python environment variables
      shell: bash
      run: |
        echo "PYTHONPATH=ai-services" >> $GITHUB_ENV
        echo "TRANSFORMERS_CACHE=/tmp/hf-cache" >> $GITHUB_ENV
        echo "HF_HOME=/tmp/hf-cache" >> $GITHUB_ENV